{% extends 'base.html' %}
{% load markdownify %}

{% block content %}


<div class="container-fluid">
  <div class="row full-height-row justify-content-center">
    <div class="col-md-8 content-panel">
      
      <!-- Card com dados do roteiro -->
      <div class="result-card">
        <h2 class="mb-3">Roteiro Gerado</h2>
        <p><strong>Destino:</strong> {{ itinerary.destination }}</p>
        <p><strong>Data Inicial:</strong> {{ itinerary.start_date }}</p>
        <p><strong>Data Final:</strong> {{ itinerary.end_date }}</p>
        <p><strong>Orçamento:</strong> {{ itinerary.budget }}</p>
        <p><strong>Viajantes:</strong> {{ itinerary.travelers }}</p>
        <p><strong>Interesses:</strong> {{ itinerary.interests }}</p>
        <p><strong>Preferências de alimentação:</strong> {{ itinerary.food_preferences }}</p>
        <p><strong>Extras:</strong> {{ itinerary.extras }}</p>
        <p><strong>Modo de transporte:</strong> {{ itinerary.transport_mode }}</p>
        <p><strong>Lugares de interesse:</strong> {{ itinerary.interest_places }}</p>
      </div>

      <!-- Card com texto da IA -->
      <div class="result-card">
        <h4>Texto Gerado pela IA:</h4>
        <div class="ai-text montserrat">
          {{ itinerary.generated_text|markdownify }}
        </div>
      </div>

      <!-- Se houver coordenadas, exibir mapa -->
      {% if lat and lng %}
      <div class="result-card">
        <h5>Localização no Mapa</h5>
        <div id="map"></div>
      </div>
      {% endif %}

      <!-- Botão voltar -->
      <a href="{% url 'list_itineraries' %}" class="btn btn-secondary mt-3">
        Voltar aos meus roteiros
      </a>

    </div>
  </div>
</div>

{% if lat and lng %}
<!-- Script de inicialização do mapa -->
<script>
  function initMap() {
    const coords = { lat: parseFloat('{{ lat }}'), lng: parseFloat('{{ lng }}') };
    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 12,
      center: coords,
    });
    new google.maps.Marker({
      position: coords,
      map: map,
      title: "Destino: {{ itinerary.destination }}"
    });
  }
</script>
<script async
  src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap">
</script>
{% endif %}
{% endblock %}
